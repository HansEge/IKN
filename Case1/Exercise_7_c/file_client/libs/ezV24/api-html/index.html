<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ezV24: The ezV24 Library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li class="current"><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>The ezV24 Library</h1><center>Copyright (c) 2002-11 Joerg Desch</center><p>The project is hosted at sourceforge. You can find the latest release of the `ezV24' library at <a href="http://libezV24.sourceforge.net/.">http://libezV24.sourceforge.net/.</a> If you have some questions, feel free to write me an email &lt;<a href="mailto:jdesch@users.sourceforge.net">jdesch@users.sourceforge.net</a>&gt;.</p>
<p>The following sections should introduce into the usage of the <code>ezV24</code> library. The build process supports static and shared libraries. Therefor you have to install the resulting <code>.so</code> file into your <em>load path</em>. The installation part of the makefile uses the standard <code>/usr/local</code> tree. The headers are stored below <code>/usr/local/ezV24</code>, while the library file itself is installed directly in <code>/usr/local/lib</code>.</p>
<h2><a class="anchor" id="S_INSTALL">
Installation</a></h2>
<p>The installation is currently <em>hard wired</em>. There is no support for the GNU auto-tools (automake or autoconf). The whole `configuration' is done by the user. You have to edit <code>ezV24_conf.h</code>. For the moment, that's all.</p>
<p>To compile and install the libary, just unpack the archive (you may have done this ;) and execute the following steps:</p>
<ol>
<li>
<p class="startli">compile the library by typing `make'. The result should be a executable shared library named `libezV24.so.*'.</p>
<div class="fragment"><pre class="fragment">
  make
  </pre></div><p class="endli"></p>
</li>
<li>
<p class="startli">become root and install the library and the header files. This call will update your ldd-cache too! Note that this doesn't install the html documentation! I'm not sure where to install it, so you can put it into your prefered directory.</p>
<div class="fragment"><pre class="fragment">
  su
  make install
  exit
  </pre></div><p class="endli"></p>
</li>
<li>
<p class="startli">Now you have the `ezV24'-library installed. The last (optional) step is to compile the sample program.</p>
<div class="fragment"><pre class="fragment">
  make test-v24
  </pre></div><p>The result is a small executable <code>test-v24</code>. To see what <code>test-v24</code> do, you must have a look into the source code.</p>
<p class="endli"></p>
</li>
</ol>
<h2><a class="anchor" id="S_USAGE">
Usage</a></h2>
<p>This section shows the general usage of the Library. The first part gives a quick overview over the `what' and `how'. The second part explains some basics using some samples.</p>
<h3><a class="anchor" id="S_QUICK">
A quick view</a></h3>
<p>To use the library for your own applications, you have to include the main header &lt;<a class="el" href="ezV24_8h.html" title="Reference of the ezV24 API.">ezV24.h</a>&gt;</p>
<div class="fragment"><pre class="fragment">
#include &lt;ezV24/ezV24.h&gt;
</pre></div><p>To link the shared library to your application, you just have to specify the basename of the library with <code>-lezV24</code>. The whole call could look like this:</p>
<div class="fragment"><pre class="fragment">
gcc -o foo foo.c -lezV24
</pre></div><p>To communicate over the serial device, you have to open and close it. Use <a class="el" href="ezV24_8h.html#ac5c162d1349468a5baf6b7ba0e10ada6">v24OpenPort</a> to open the device. The next step is the correct setup of the communication parameters with <a class="el" href="ezV24_8h.html#a92c7ac4f0f38461d7a0cce539f05c6d8">v24SetParameters</a>. Note that you must have the access rights to do this. After the communication is done, use <a class="el" href="ezV24_8h.html#aab3f3455a16d6c2151951ef1fdfd2f0e">v24ClosePort</a> to close the port and release the lock.</p>
<p>To send and receive data, there are several pairs of functions available. It is possible to send and receive single bytes with <a class="el" href="ezV24_8h.html#a9bb93d1fcbfbba403156a7963bf01069">v24Getc</a> and <a class="el" href="ezV24_8h.html#a6d3f1eb84f50c19174ad68be05662785">v24Putc</a>. To send an array with data, the functions 24Read and <a class="el" href="ezV24_8h.html#a18f963cd6d92135c7364987a05f05521">v24Write</a> are the right choice. At last, usage of ASCIIZ strings is possible using <a class="el" href="ezV24_8h.html#ab2632a7e84d5eb66e5ddaddd0b8dbcbc">v24Gets</a> and <a class="el" href="ezV24_8h.html#a82e7f473a61ff4d8db08a58964edf84a">v24Puts</a>.</p>
<p>More details and a few snippets of code are shown in the section "The Hello-World-Sample".</p>
<h3><a class="anchor" id="S_HELLO">
The Hello-World-Sample</a></h3>
<p>The previous section introduces a very short overview. Here we want to show you a whole sample. This sample is cut into smaller pieces. Each piece have its own description. Ok, let's start with a skeleton.</p>
<div class="fragment"><pre class="fragment">
// sample.c
#include &lt;stdio.h&gt;
#include &lt;ezV24/ezV24.h&gt;

v24_port_t *UsedPort=NULL;

static void installSignalhandler ( void )
{
    signal(SIGINT,mySignalHandler);
    signal(SIGTERM,mySignalHandler);
}

static void mySignalHandler ( int reason )
{
    v24ClosePort(UsedPort);
    exit(99);
}

void main (void)
{
    installSignalhandler();
    // part-2 ...
}
</pre></div><p>The above skeleton <code>sample.c</code> shows several important parts. First it includes the base header of the library. After this, the global variable <code>UsedPort</code> is declared and set to <code>NULL</code>. This variable will hold the initialized handle. To ensure that the program close the port, a signal handler is installed by <code>installSignalhandler</code>.</p>
<div class="fragment"><pre class="fragment">
    // part-2
    UsedPort=v24OpenPort("/dev/ttyS0",V24_STANDARD);
    if ( UsedPort==NULL )
    {
        fputs("error: sorry, open failed!\n",stderr);
        return;
    }
    // part-3 ...
    v24ClosePort(UsedPort);
</pre></div><p>This part opens the device <code>/dev/ttyS0</code>. After the work (of part-3) is done, the port is closed. This snippet doesn't use any special <em>open flags</em>. The port name is fixed. To be a little bit more platform independent, we can use <a class="el" href="ezV24_8h.html#a6f023e7090c526a6be5468b9423ce12d">v24PortName</a>.</p>
<div class="fragment"><pre class="fragment">
    // part-3
    rc=v24SetParameters(UsedPort,V24_B9600,V24_8BIT,V24_NONE);
    if ( rc!=V24_E_OK )
    {
        fputs("error: setup of the port failed!\n",stderr);
	v24ClosePort(UsedPort);
	return 1;
    }
    // part-4 ...
</pre></div><p>In part-3, we try to set the communication parameters of the opened port. In the above sample, the baudrate is set to 9600. The size of the data byte is set to 8 bits, and the parity bit generation is disabled. To see all possible parameters, just have a look at <a class="el" href="ezV24_8h.html#a92c7ac4f0f38461d7a0cce539f05c6d8">v24SetParameters</a>. The shown setup is the default used by <a class="el" href="ezV24_8h.html#ac5c162d1349468a5baf6b7ba0e10ada6">v24OpenPort</a>. Nevertheless, it is better to use an explicit call to <a class="el" href="ezV24_8h.html#a92c7ac4f0f38461d7a0cce539f05c6d8">v24SetParameters</a> to setup the port. The code will be more readable and IMO it's better style.</p>
<p><b>Note:</b> as you can see, the program aborts, if the setup fails. Because of this, we have to close the port!</p>
<div class="fragment"><pre class="fragment">
    // part-4
    char* msg="Hello world.\n\r";
    char answer[80];
    rc=v24Puts(UsedPort,msg);
    if ( rc &lt; strlen(msg) )
    {
        fputs("error: v24Puts failed.\n",stderr);
    }
    else
    {
        rc=v24Gets(UsedPort,answer,sizeof(answer)-1);
        if ( rc &lt; 0 )
        {
            fputs("error: v24Gets failed!\n",stderr);
        }
        else
            printf("the answer is `%s'\n",answer);
    }
</pre></div><p>This snippet of part-4 sends the string <code>"Hello world.\n\r"</code>. If all characters are sent, it waits for a reply. Look's good? </p>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Tue Apr 12 10:17:25 2011 for ezV24 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
